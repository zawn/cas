---
layout: 违约
title: CAS - 设计认证策略
category: 认证
---

# 自定义身份验证策略

虽然 CAS 对各种系统的身份验证支持有些全面和复杂，但一个常见的部署使用案例是设计自定义身份验证方案的任务。 本文档描述了设计和注册自定义身份验证策略所需的必要步骤（即 `认证汉德勒`）在中科院。

本指南真正面向对春季、春季启动和春季网络流有基本到中等熟悉程度的开发人员。 这是 *不* 一个教程，通过副本/粘贴逐字使用。 相反，这是开发人员根据专门要求扩展 CAS 的配方。

## 概述

总体任务可以归类为：

1. 设计身份验证处理程序。
2. 使用 CAS 认证引擎注册身份验证处理器。
3. 让 CAS 识别身份验证配置。

## 设计

第一步是定义身份验证处理程序本身的骨架。 这是其工作的核心主要组成部分，其工作是宣布对给定类型的凭据的支持，然后尝试验证它并产生成功的结果。 所有处理程序扩展的核心父组件是 `身份验证汉德勒` 接口。

假设此处使用的凭据类型处理传统用户名和密码（下面是臭名昭著的 `用户名密码信用` 所指出，因此为自定义身份验证处理程序定义的更合适的骨架可能看起来如下示例：

```java
包公司示例. cas;

公共类我的授权汉德勒扩展抽象使用密码授权汉德勒{
    ...
    保护身份验证汉德勒执行结果认证用户密码内部（
        最终用户名密码信用凭据，
        最后的字符串原始密码） [

        如果 （一切看起来都很好） [
            返回创建汉德勒雷索 （证书，
                这个. 主要工厂. 创建原则 （用户名）， 无效）;
        =
        抛出新的失败记录例外 （"对不起， 你是一个失败
    
    ！
}
```

### 回顾

- 身份验证处理程序能够生成完全解析的本金以及属性。 如果您能够从与原始用户/主帐户存储相同的位置检索属性，则此处解决的最终 `本金` 对象必须在施工时携带所有这些属性和索赔。

- 最后一个参数， `无效`，实际上是最终工作到身份验证链，并有条件地显示给用户的警告集合。 此类警告示例包括接近到期日的密码状态等。

- 身份验证处理程序还能够通过抛出一些特定的例外来阻止身份验证。 一个更常见的例外是 `故障日志例外` 注意身份验证失败。 可能会抛出其他特定的例外，以指示帐户状态本身的异常，如 `帐户禁用例外`。

- 各种其他组件，如 `主名转换器`， `密码编码器`s等也可能注入到我们的处理程序，如果需要的话，虽然这些现在跳过在此职位的简单性。

## 注册

一旦处理程序被设计好，它需要在CAS注册并放入认证引擎中。 这是通过 `@Configuration` 类的魔力完成的，这些类在运行时会根据您的批准自动拾取， 其工作是了解如何动态修改应用上下文。

```java
包公司示例. cas;

@Configuration（"我授权发明计划配置"）
@EnableConfigurationProperties（案例配置.class）
公共类"我授权计划配置
                    实施认证发明计划配置器+
    @Autowired
    私人案例配置配置程序：

    @Bean
    公共身份验证汉德勒我授权汉德勒（）=
        var处理器=新的My验证汉德勒（）;
        /*
            配置处理程序通过调用各种设置方法。
            请注意，您还可以完全访问已解决的 CAS 设置的集合。
            请注意，每个身份验证处理程序可选择地获得"订单"
            以及唯一名称。
        */
        返回h：
    =

    @Override
    公共无效配置授权执行计划（最终认证执行计划）{
        （感觉良好星期一上午）{
            计划。注册授权汉德勒（我的授权汉德勒）：
        =
    =
}
```


现在，我们已经在 CAS 认证机制中正确创建和注册了处理程序，我们只需要确保 CAS 能够接收我们的特殊配置。 为此，创建一个 `src/主/资源/META-INF/Spring.工厂` 文件并引用其中的配置类：

```properties
组织.弹簧框架.启动.自动配置。启用自动配置]\
    com.示例.cas.我的验证事件执行配置
```

有关注册策略的更多了解，请 [本指南](http://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-developing-auto-configuration.html)。

在运行时，中科院将尝试自动检测所有成分和豆类，宣传自己为 `认证发明计划配置器`。 然后调用每个检测到的组件来注册自己的身份验证执行计划。 此操作的最终结果将生成一个现成的身份验证处理程序集合，这些处理程序可在指定的给定顺序中（如果有）中调用。
