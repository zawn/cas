---
layout: 违约
title: 中科院 - 清除通行证
category: 认证
---

# 清除通行证：凭据缓存和重播

要使单个登录进入某些旧应用，可能需要向它们提供实际密码。 虽然这种方法不可避免地会增加安全风险，但有时，为了将 应用与 CAS 集成，这可能是一种必要的罪恶。

<div class="alert alert-warning"><strong>使用警告！</strong><p>默认情况下，清除通道已关闭。
除非以下配置的
明确打开 ClearPass，否则任何应用程序都无法获得用户凭据。 在打开此功能之前，请仔细考虑 <strong>非常</strong> ，因为它 <strong>必须</strong>
集成工作的最后手段。。。也许甚至不是那样</p></div>

## 概述

CAS 能够在 CAS 验证响应中直接发布凭证密码。 以前，这是通过代理身份验证序列 处理的，并获得了 ClearPass 服务的代理授予票证，并且是必要的 ，以便在客户端应用程序和 CAS 服务器之间建立信任。 本文档描述了可以应用的配置 ，以便接收作为 CAS 验证响应中的属性的凭据密码。

为了成功建立 CAS服务器与应用之间的信任，客户端应用程序生成了私钥/公钥对，然后 **在CAS内部分发和配置的公钥** 。 CAS 将使用公钥加密凭据 密码，并将在验证响应中发布新的属性 `<credential>` ，前提是该服务有权接收该属性。

请注意，仅通过 CAS 验证响应执行凭证的退货，前提是客户端 申请向 `/p3/服务验证` 端点（或 `/p3/代理验证`）发出请求。 向 CAS 返还属性的其他 方法（如 SAML1） **不会** 支持此值的额外返回。

另请注意，CAS 默认尝试通过自己的预生成密钥加密内存中的缓存凭据， 进行签名和加密。 当属性发布到应用程序时，CAS 将首先 凭据进行内部解码，然后再次尝试使用服务的公钥凭据对其进行加密。 此行为可以通过</a>设置进行控制。</p>

<div class="alert alert-info"><strong>通过代理清除密码！</strong><p>CAS 不再支持通过代理机制检索
凭据。 打算获得证书
的应用程序需要更新，以考虑此处描述的以下方法。</p></div>

## 缓存凭据

启用 CAS 属性中的缓存和捕获凭据。 要查看 CAS 属性的相关列表，请 [查看本指南](../configuration/Configuration-Properties.html#clearpass)。



## 创建密钥

密钥对接必须由希望获得用户凭据的应用程序本身生成。 公共密钥与 CAS 共享。 应用程序使用私钥解密凭据。



```bash
打开斯尔根萨 - 出私人.key 1024
打开斯尔 rsa - 酒吧 - 在私人.key - 出公共.key - 通知 Pem - 超越 Der
打开 pkcs8 - topk8 - 通知每 - 通知佩尔 - 诺克里普特 - 在私人.key - 出私人. p8
```


请注意，虽然 `1024` 完全正常，但您可能需要将密钥大小调整到更大的值 （如 `4096` 等较大值，以便 CAS 能够加密长度过长的凭据。



## 注册公钥

一旦您从客户端应用程序所有者处收到公共密钥，它必须首先在 CAS 服务器的服务注册表内注册 。 持有上述公钥的服务还必须 授权接收密码作为所选属性发布策略的属性。



```json
•
  "@class"："org.apereo.cas.服务.注册服务"，
  "服务id"："[https://.+"，
  "属性重新发布政策"：{
    "@class"："org.apereo.cas.服务。返回归因发布政策"，
    "授权发布信用密码"： 真正的
  [，
  "公共钥匙"： [
    "@class"： "org. apereo. cas. 服务. 注册服务公共密码"，
    "位置"： "类路径： 公共.key"，
    "算法"： "Rsa"
  [
]
```




## 解密密码

客户端申请在 CAS 验证响应中收到 `凭据` 属性后，可以通过自己的私钥解密 。 由于该属性在默认情况下是 base64 编码的，因此在进行解密之前，需要先解码 。 下面是示例代码片段：



```java
最终地图<?, ?> 属性=...
最终字符串编码Psw=（字符串）属性。get（"凭据"）：

/*使用上面生成的私有.key文件。 */
最后的私人钥匙私人钥匙=...
最后的密码密码=密码。获取安装（私钥。获取高利特）：
最后一个缩写 [] 信任 64 = 解码基地 64 （编码;
密码. init （Cipher.DECRYPT_MODE， 私人钥匙）：
最后的旁特 [] 密码数据 = 密码. dofinal （信用 64）;
返回新字符串（密码数据）：
```
