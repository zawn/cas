---
layout: 违约
title: CAS - 多因素认证
category: 多因素认证
---

# 多因素认证 （MFA）

CAS 为各种多因素身份验证提供商和选项提供支持，同时允许其自行设计。 次要身份验证因子在</em> 主要步骤后始终处于 *，如果请求或触发需要，将要求现有身份验证会话向所需的多因素身份验证因子加强。 满意的身份验证上下文被传达回应用程序，以及表示成功的多因素身份验证事件。</p>

至少，您需要回答以下问题：

- 我们使用的是哪个提供商进行多因素身份验证？
- 我们如何以及为谁触发多因素身份验证？

## 支持提供商

以下多因素提供者由中科院支持。

| 供应商      | ID          | 指示                                               |
| -------- | ----------- | ------------------------------------------------ |
| 双安全      | `姆法杜`       | [见本指南](DuoSecurity-Authentication.html)。         |
| 奥蒂认证器    | `姆法奥蒂`      | [见本指南](AuthyAuthenticator-Authentication.html)。  |
| 接受托托     | `姆法 -接受托`   | [见本指南](Acceptto-Authentication.html)。            |
| 尤比基      | `姆法 - 尤比基`  | [见本指南](YubiKey-Authentication.html)。             |
| RSA/拉迪乌斯 | `姆法半径`      | [见本指南](RADIUS-Authentication.html)。              |
| 威基德      | `姆法半径`      | [见本指南](RADIUS-Authentication.html)。              |
| 谷歌身份验证器  | `姆法高斯`      | [见本指南](GoogleAuthenticator-Authentication.html)。 |
| 菲多U2F    | `姆法-乌2f`    | [见本指南](FIDO-U2F-Authentication.html)。            |
| FIDO2网络网 | `姆法 - 韦伯恩`  | [见本指南](FIDO2-WebAuthn-Authentication.html)。      |
| CAS 简单   | `姆法简单`      | [见本指南](Simple-Multifactor-Authentication.html)。  |
| 旋转安全     | `姆法 - 斯威维尔` | [见本指南](SwivelSecure-Authentication.html)。        |
| 习惯       | 习惯          | [见本指南](../mfa/Custom-MFA-Authentication.html)。   |

## 触发器

多因素身份验证可以通过多个触发器激活。 要了解更多，请 [请参阅本指南](Configuring-Multifactor-Authentication-Triggers.html)。

## 旁路规则

每个多因素提供商都配备了允许 MFA 旁路的选项。 要了解更多，请 [请参阅本指南](../mfa/Configuring-Multifactor-Authentication-Bypass.html)。

## 故障模式

默认情况下，身份验证策略支持故障关闭模式，这意味着如果您尝试行使 CAS 和提供商可用的特定 提供商，则将停止身份验证并显示错误 。 当然，如果提供商无法响应，您可以更改此行为，以便在不行使提供商 功能的情况下进行身份验证。

支持以下故障模式：

| 田    | 描述                                 |
| ---- | ---------------------------------- |
| `闭`  | 如果无法联系到提供商，则身份验证将被阻止。              |
| `打开` | 如果提供商不可用，则未向客户传达尚未请求的 MFA 的身份验证收益。 |
| `幽灵` | 如果提供商不可用，则向客户传达身份验证收益和请求的 MFA。     |
| `没有` | 根本不联系提供商以检查可用性。 假设提供程序可用。          |

### 故障模式选择

CAS 将在请求提供商无法联系到的情况下咨询当前配置，以确定如何继续。  
故障模式可以在这些位置进行配置，CAS 将按此顺序使用第一个定义的故障模式：

- 注册服务多因素认证政策
- 多因素身份验证提供商配置
- 全球多因素身份验证配置

如果没有遇到可操作的失败模式，用户将看到一条通用的"认证失败"消息。

### 按注册服务分的故障模式

设置为"多因素政策"的一部分。  此位置将覆盖在任何其他位置设置的模式的故障。

```json
•
  "@class"："组织.apereo.cas.服务.注册服务"，
  "服务id"："^（https|图片）"，
  "id"：100，
  "多因素政策"：{
    "@class"："org.apereo.cas.服务。默认注册服务多因素政策"，
    "多因素授权提供者"："java.uled.使用。领英哈什集"，"mfa-duo"]，
    "失败模"："关闭"
  }
}
```

### 多因素身份验证提供商的失败模式

每个定义的多因素身份验证提供商都可以设置自己的故障模式策略。 在此位置设置的故障模式将覆盖全球故障模式，但将推迟到注册服务设置的任何故障模式。

要查看 CAS 属性的相关列表，请 [查看本指南](../configuration/Configuration-Properties-Common.html#multifactor-authentication-providers)。

### 全球故障模式

默认故障模式可以通过 CAS 属性在全球指定，并将在提供商或注册服务中未设置故障模式的情况下使用。

要查看 CAS 属性的相关列表，请 [查看本指南](../configuration/Configuration-Properties.html#multifactor-authentication)。

## 多个提供商选择

如果确定多个多因素身份验证提供商进行多因素身份验证交易，默认情况下，CAS 将尝试根据供应商的排名对提供商的集合进行排序，并将选择具有最高优先级的集合。 如果在每个触发器决定不同的多因素身份验证提供商时定义多个触发器，或者使用许多实例多次配置同一提供商实例，则可能会出现此使用案例。

提供商选择也可以更动态地使用 Groovy 脚本策略进行。 以下示例应作为如何根据 Groovy 脚本选择多因素提供商的轮廓：

```groovy
导入java.util.*

类示例流明程序提供者选择=
    d def字符串运行（最终对象。。。args）{
        定义服务=args[0]
        def本金=args[1]
        防御供应商收集=args[2]
        除伐木机=args[3]
        ...
        返回"姆法杜"
    }
}
```

通过的参数如下：

| 参数      | 描述                                |
| ------- | --------------------------------- |
| `服务`    | 表示请求中提供的传入服务的对象（如果有的话）。           |
| `主要`    | 表示经过验证的主体及其属性的对象。                 |
| `供应商收集` | 代表符合交易资格的候选多因素提供商的集合的对象。          |
| `记录`    | 负责发布日志消息的对象，如 `logger.info（。。。）`。 |


要查看 CAS 物业的相关列表，请 [](../configuration/Configuration-Properties.html#multifactor-authentication)查看本指南。

## 排名提供商

有时，CAS 需要在需要加强认证时确定正确的提供商。 试想一下，CAS 已经建立了一个SSO会话与/没有供应商，并已达到认证水平。 另一个传入的 请求尝试使用 SSO 会话，该会话具有不同且经常相互竞争的认证要求，该要求可能与 CAS 已建立的身份验证级别不同 。 具体来说，例子可能是：

- CAS 已实现 SSO 会话，但单独的请求现在需要通过 DuoSecurity 进行加强认证。
- CAS 已实现由 DuoSecurity 满意的认证级别的 SSO 会话，但现在需要使用 YubiKey 进行升级认证。

在某些情况下，CAS 将尝试对认证级别进行排名并相互比较。 如果 CAS 已达到高于应入请求要求的水平 ，则不会执行进一 步认证。 如果情况正好相反，中科院将 将认证流程路由到所需的认证级别，并在成功后，将调整SSO会话与新的更高的 认证水平现在满意。

认证方法的排名是每个提供商通过 CAS 设置中每个提供商的特定属性完成的。 请注意， 级别值越高，它所保持的安全级别就越高。 具有较大权重值的较高排名提供商胜过 并超越价值较低的其他提供商。

## 提供商选择菜单

如果多个多因素身份验证提供商符合身份验证请求，CAS 可以配置为 向用户提供所有选项，允许他们选择在给定时间最有意义的提供商。 这种方法是排名提供商的替代策略。

要查看 CAS 属性的相关列表，请 [查看本指南](../configuration/Configuration-Properties.html#multifactor-authentication)。

## 受信任的设备/浏览器

CAS 能够作为任何多因素身份验证流程的一部分，以本地为本地提供受信任的设备/浏览器功能。 虽然某些提供商也倾向于支持此功能，但此行为现在已直接提交 CAS，为您提供设备/浏览器检查方式的精确控制，该决策如何记住后续请求，以及您如何允许授权管理这些受信任的决策，无论是管理员还是最终用户。

[请参阅本指南了解更多信息](Multifactor-TrustedDevice-Authentication.html)。

## 2FA vs. MFA

CAS 中的多因素身份验证在部署时大多以双重身份验证的形式出现。 但是，该框架的设计方式允许将其他提供商的额外链条链接到现有的身份验证体验中。 如果您需要将多个因素一个接一个地串在一起，则可能需要调整和扩展现有身份验证工作流程以交付使用案例。

## 设置

要查看 CAS 属性的相关列表，请 [查看本指南](../configuration/Configuration-Properties.html#multifactor-authentication)。
