---
layout: 违约
title: CAS - 记录配置
category: 日志 & 审计
---

# 伐木

CAS 提供记录重要信息事件（如身份验证成功和 故障）的记录设施：可以自定义以生成用于故障排除的其他信息。 默认情况下，CAS 将 Slf4j 伐木框架用作 [Log4j 发动机](http://logging.apache.org) 的外墙。

默认日志4j配置文件位于 `cas-服务器-Webapp资源` 源模块.xml</code> 的 `src/主/资源/log4j2 中。 在 <code>cas.war` 它被发现在 `的cas-服务器-Web应用程序资源*.jar`的根源。 cas-叠加附带外部日志42.xml等/cas/配置和属性 `记录。配置文件：/等/cas/配置/log4j2.xml` 设置为引用它。 默认情况下，对于与 `org.apereo.cas` 代码相关的所有功能，将设置为 `INFO` 。 出于调试和诊断目的，您可能需要将这些级别设置为 `DEBUG` 或 `跟踪`。

<div class="alert alert-warning"><strong>生产</strong><p>你应该总是运行
<code>警告</code>下的一切。 在生产警告和错误中，您关心的是。 其他一切都只是诊断。 只有
 <code>DEBUG出现</code> 或 <code>INFO</code> ，如果你需要研究一个特定的问题。</p></div>

## CAS自定义日志4j2插件
CAS使用日志4j2.xml文件包括自定义日志4j2插件：
- CasAppender： CasAppender 包裹了另一个常规应用程序，并从日志条目中删除敏感值， 如票务赠与票证或代理授予票证。
- 例外过滤：为了让 CAS 能够在 WARN 和 ERROR 中自由记录意外错误，而不会遮挡堆栈跟踪 的所有内容，默认情况下会禁用日志中的异常情况，但有日志4j2.xml属性可以重新打开 它们。 默认情况下，所有例外都写入专用的堆栈跟踪滚动日志文件 ，这是使用嵌入 CasAppender 中的自定义异常过滤器完成的。

## 日志4j2属性
log4j2.xml文件包括各种设置的属性，这些属性可以设置在日志4j2.xml文件的属性部分 ，在名为 `日志4j2.组件的属性文件中，或作为系统 
属性` 。 如果将属性设置在 `日志4j2.组件中，则属性`，请务必包括：
```
日志 4j 康特克斯特塞勒克托 \ org. 阿帕奇. 记录. log4j. 核心. 同步. 阿同步记录器电子
```
以保持使用CAS默认设置的异步记录。 要关闭异步记录，请在 `日志4j2.组件中包括以下内容` 。
```
日志4j康泰克勒克特.org.阿帕奇.记录.log4j.核心.选择器.基础信标
```

## 配置

将 `日志4j2.xml` 文件外部化到系统路径以保存升级之间的设置通常很有帮助。 默认情况下， `日志4j2.xml` 文件的位置位于运行时间类路径上，可以通过CAS属性 进行控制。

要查看 CAS 属性的相关列表，请 [查看本指南](../configuration/Configuration-Properties.html#logging)。

### 日志级别

虽然日志水平可以通过原生 `日志4j2.xml` 语法直接按摩，但也可以使用通常的 CAS 属性 修改它们。 要查看 CAS 属性的相关列表，请 [查看本指南](../configuration/Configuration-Properties.html#logging)。

### 刷新间隔

`日志4j2.xml` 本身控制记录配置的刷新间隔。 Log4j 能够 自动检测配置文件的变化并重新配置本身。 如果 `监视器在配置元素上指定了Interval` 属性，并设置为非零值，则下次评估和/或记录日志事件时将 检查文件，并且自上次检查 以来， `监视器Interval` 已经过去。 这将允许您在不重新启动 服务器环境的情况下调整日志级别和配置。

```xml<!--在几秒钟内指定内部刷新。 --><Configuration monitorInterval="15" ...>
    ...
</Configuration>
```

### 应用者

应用者负责将日志事件传递到目的地。 应用对象通常只负责将事件数据编写到目标目标目标 。 在大多数情况下，他们将活动格式化的责任委托给布局。 一些应用程序包装其他应用程序，以便他们可以修改日志事件， 处理 `应用`中出现的故障，根据高级筛选标准将事件路由到从属 `Appender` ，或提供类似的 功能，不直接格式化事件以供查看。 `阿彭德`总是有一个名字，以便他们可以从 `伐木`引用。

以下 `应用程序` 元素只是可用选项的部分集合。

| 布局         | 描述                                                                                              |
| ---------- | ----------------------------------------------------------------------------------------------- |
| `阿同步应用程序`  | 接受对其他应用方的引用，并导致将日志事件写在单独的线程上。                                                                   |
| `卡桑德拉·普彭德` | 将其输出写入阿帕奇卡桑德拉数据库。 必须提前配置密钥空间和表，并且列应映射在配置文件中。                                                    |
| `控制台应用`    | 将其输出写入 `系统.out` 或 `系统。` 与 `系统。out` 默认目标。                                                        |
| `故障转移应用`   | 包装一组应用程序。 如果主要应用程序失败，次要应用程序将按顺序试用，直到一个成功或不再有辅助程序尝试。                                             |
| `文件应用程序`   | 写入 `文件中命名的文件名称` 参数。                                                                             |
| `茨夫帕拉米莱奥特` | 将事件的参数转换为 CSV 记录，忽略消息。                                                                          |
| `京东应用`     | 使用标准的JDBC将日志事件写入关系数据库表。                                                                         |
| `贾帕彭德`     | 使用 Java 持久 API 将日志事件写入关系数据库表 `2.1`。                                                             |
| `赫特普彭德`    | 通过HTTP发送日志事件。 必须提供布局来格式化日志事件。                                                                   |
| `卡夫卡阿彭德`   | 将事件记录到阿帕奇·卡夫卡主题。 每个日志事件都作为卡夫卡记录发送。                                                              |
| `诺斯基拉彭德`   | 将日志事件写入 NoSQL 数据库;蒙哥德银行和阿帕奇沙发开发银行目前存在提供商实施程序。                                                   |
| `路由应用程序`   | 评估日志事件，然后将它们路由到下属 `应用程序`。                                                                       |
| `斯姆特普应用`   | 在发生特定的记录事件时发送电子邮件，通常是在错误或致命错误时。                                                                 |
| `耶罗姆克`     | ZeroMQ 应用程序使用 JeroMQ 库将日志事件发送到一个或多个零MQ 端点。                                                      |
| `滚动文件应用程序` | 写到文件名称参数中命名的文件，并根据触发政策</code> 和 `翻滚政策``滚动文件。</td>
</tr>
<tr>
  <td><code>重写应用程序` | Allows the log event to be manipulated before it is processed by another `Appender`. 这可用于掩盖敏感信息（如密码）或将信息注入每个事件。 |

有关详细信息，请查看官方 [Log4j 文档](http://logging.apache.org)

### 日志模式

默认情况下，大多数通过 `日志4j2提供的应用程序.xml` 文件使用基于模式的布局 格式化日志消息。 还可用于以下替代布局：

| 布局          | 描述                                                                   |
| ----------- | -------------------------------------------------------------------- |
| `茨夫帕拉米莱奥特`  | 将事件的参数转换为 CSV 记录，忽略消息。                                               |
| `格尔夫莱尤特`    | 在灰log扩展日志格式（geLF``）中列出事件。                                            |
| `赫特姆莱奥特`    | 生成 HTML 页面，并将每个日志事件添加到表中的行中                                          |
| `杰森莱尤特`     | 在形成良好或支离破碎的 JSON 中创建日志事件。                                            |
| `模式退出`      | 即使基于转换模式，也会对日志进行格式化。                                                 |
| `RFC5424退出` | 格式日志事件根据 [RFC 5424](http://tools.ietf.org/html/rfc5424)，增强的Syslog规范。 |
| `序列化出`      | 日志事件被转换为在JMS或插座连接中有用的字节阵列。                                           |
| `赛斯洛格莱尤特`   | 将事件格式化为BSD Syslog记录。                                                 |
| `X毫升退出`     | 在形成良好或支离破碎的 XML 中创建日志事件。                                             |
| `亚姆莱尤特`     | 在YML中创建日志事件。                                                         |

要了解有关每个细微差别和配置设置的更多，请参阅 [官方日志4J指南](http://logging.apache.org)。

## 日志文件旋转

默认配置指定在启动时、大小或特定时间滚动日志的触发策略。 这些策略适用于 `滚动文件` 应用程序。

例如，以下 XML 片段定义了在 JVM 开始时、日志大小达到 10</code> MB `以及当前日期不再匹配日志的开始日期时滚动日志的政策。</p>

<pre><code class="xml"><RollingFile name="file" fileName="${baseDir}/cas.log" append="true"
                    filePattern="${baseDir}/cas-%d{yyyy-MM-dd-HH}-%i.log">
    ...
    <Policies>
        <OnStartupTriggeringPolicy />
        <SizeBasedTriggeringPolicy size="10 MB"/>
        <TimeBasedTriggeringPolicy interval="24" />
    </Policies>
    ...
</RollingFile>
`</pre>

触发策略决定 **是否应执行** 展期，并且还可以设计展期策略，以指示 **应该如何** 。 如果没有配置策略，将使用默认值。

要查找更多全面的文档，请 [查看此处的指南](http://logging.apache.org)。

### 展期战略

自定义的展期策略提供了一个删除操作，使用户能够比默认翻滚策略的最大属性更能够控制在展期时间删除哪些文件。 删除操作允许用户配置一个或多个条件，选择相对于基本目录删除的文件。

例如，在展期时，以下应用器会删除与 `*/*.log` 球匹配的基础目录下的所有文件，并且 `7` 天或更久。

```xml
<RollingFile name="file" fileName="${baseDir}/cas.log" append="true"
             filePattern="${baseDir}/cas-%d{yyyy-MM-dd-HH}-%i.log">
    ...
    <DefaultRolloverStrategy max="5">
        <Delete basePath="${baseDir}" maxDepth="2">
            <IfFileName glob="*/*.log" />
            <IfLastModified age="7d" />
        </Delete>
    </DefaultRolloverStrategy>
    ...
</RollingFile>
```

要查找更多全面的文档，请 [查看此处的指南](http://logging.apache.org)。

## 日志数据卫生

出于安全考虑，CAS 默认将尝试从所有日志数据中删除出票证和代理授予票证 ID。 这当然包括通过记录框架路由到日志目的地的消息以及所有审计消息。

示例如下：

```bash
世卫组织：审计：未知
什么：TGT-***123456-cas01.example.org
行动：TICKET_GRANTING_TICKET_DESTROYED
申请：CAS
时间：2014年7月12日星期六04：10：35 PDT 2014
客户IP地址：
服务器 IP 地址： ...
```

在票证 ID 的尾端留下一定数量的字符，以帮助进行故障排除和诊断。

要查看 CAS 属性的相关列表，请 [查看本指南](../configuration/Configuration-Properties.html#logging)。
