---
layout: 违约
title: CAS - 安全指南
category: 规划
---

# 安全指南

CAS 是一种安全软件，可为基于 Web 的应用程序提供基于 Web 的安全单个登录。 单次登录 在安全性和便利性方面提供了双赢：它减少了对单个受信任的凭据 经纪人的密码曝光，同时透明地提供对多个服务的访问，而无需重复登录。 CAS 的使用通常 改善安全环境，但 CAS 的配置、政策和部署存在一些问题，应 考虑以实现适当的安全性。

<div class="alert alert-info"><strong>报告问题</strong><p>安全团队要求您 <strong>不要</strong> 创建可公开查看的问题或帖子，以讨论您可能认为的安全漏洞。 要正确报告问题并了解如何产生响应，请 <a href="/cas/developer/Sec-Vuln-Response.html">本指南</a>。</p></div>

## 公告

- [2020 年 10 月 14 日漏洞披露](https://apereo.github.io/2020/10/14/gauthvuln/)
- [2020年7月24日 漏洞披露](https://apereo.github.io/2020/07/24/credvuln/)
- [2020年2月8日 漏洞披露](https://apereo.github.io/2020/02/08/webflowcrypto/)
- [2019 年 12 月 20 日漏洞披露](https://apereo.github.io/2019/12/20/surrogatevuln/)
- [2019 年 11 月 21 日漏洞披露](https://apereo.github.io/2019/11/24/smfavuln/)
- [2019 年 9 月 27 日漏洞披露](https://apereo.github.io/2019/09/27/numvulndisc/)
- [2018 年 9 月 26 日漏洞披露](https://apereo.github.io/2018/09/26/mfavulndisc/)
- [2017年3月6日 漏洞披露](https://apereo.github.io/2017/03/06/moncfgsecvulndisc/)
- [2016 年 10 月 24 日漏洞披露](https://apereo.github.io/2016/10/24/servlvulndisc/)
- [2016 年 4 月 8 日漏洞披露](https://apereo.github.io/2016/04/08/commonsvulndisc/)

## 系统安全考虑

要考虑的基础设施安全事项可能包括以下内容。

### 安全运输 （https）

与 CAS 服务器的所有通信都必须通过安全通道进行（即 TLSv1）。 这项要求有两个主要 理由：

1. 身份验证过程需要传输安全凭据。
2. CAS 出票票是无记名令牌。

由于这两个数据的披露都允许模拟攻击，因此保护 CAS 客户端和 CAS 服务器之间的 通信通道至关重要。

实际上，这意味着所有 CAS 网址必须使用 HTTPS，但它也 **** 意味着必须使用 HTTPS 完成从 CAS 服务器到应用程序 的所有连接：

- 当生成的服务票被发送回"服务"网址上的应用程序时
- 当代理回调网址被调用时。

要查看 CAS 属性的相关列表并调整此行为，请 [查看本指南](../configuration/Configuration-Properties.html#http-client)。


### 连接到附属系统

CAS 通常需要连接到其他系统，如 LDAP 目录、数据库和缓存服务。 我们通常建议尽可能将安全运输 （SSL/TLS、IPSec） 用于这些系统，但可能会 补偿性控制，因此安全运输变得没有必要。 具有严格 接入控制的专用网络和公司网络是常见的例外，但仍建议安全传输。 客户认证验证可能是LDAP带来足够安全性的另一个好解决方案。

如前所述，必须确保与其他系统的连接。 但是，如果 CAS 服务器部署在多个节点上，则 同样适用于 CAS 服务器本身。 如果基于缓存的票证注册表在 CAS 服务器上的单个 运行没有任何安全问题，则如果网络不受保护，则同步在使用多个节点时可能会成为安全问题。

如果未正确保护，任何磁盘存储也容易受到攻击。 可能会关闭到磁盘的 EhCache 溢出以增加 保护，而数据库磁盘存储应使用先进的加密数据机制。

## 部署驱动的安全功能

CAS 支持一些可以利用这些功能来实施各种安全策略的功能。 以下功能通过 CAS 配置和 CAS 客户端集成提供。 请注意，许多功能 可开箱即用，而其他功能则需要明确的设置

### 强制身份验证

许多 CAS 客户端和支持的协议支持强制身份验证的概念，即用户必须 重新身份验证才能访问特定服务。 CAS 协议支持通过 _续订_ 参数强制认证。 强制身份验证为 SSO 会话负责人的身份提供了额外的保证，因为用户必须在访问之前验证其凭据。 强制身份验证适用于需要或强制要求更高安全性的服务。 通常强制 身份验证是按服务配置的，但 [服务管理](#service-management) 设施 作为集中安全政策实施强制认证提供了一些支持。 强制身份验证可以与 [多重身份验证](../configuration/Configuration-Properties.html#multifactor-authentication) 功能相结合，以 实施任意针对特定服务的访问控制策略。


### 被动身份验证

一些 CAS 协议支持被动身份验证，当请求时，匿名授予对 CAS 保护服务的访问 。 CASv2 和 CASv3 协议通过 _网关_ 功能支持此功能。 被动身份验证 补充强制身份验证;如果强制身份验证需要身份验证才能访问服务，被动 身份验证允许服务访问，尽管是匿名的，但无需身份验证。


### 代理身份验证

代理身份验证（或委托身份验证）提供了 CAS 强大、重要且具有潜在安全性改进 功能。 代理身份验证由 CASv2 和 CASv3 协议支持，并由代表用户的服务请求的代理票证 进行调解：因此，服务代理为用户进行身份验证。 代理身份验证通常用于服务无法直接与用户交互的情况，并作为将最终用户凭据重播到服务的 替代方案。

但是，代理票具有风险，因为接受代理票证的服务负责验证 代理链（委托最终用户身份验证到达 票证验证服务的服务列表）。 服务可以通过对/服务验证 验证端点验证票证来完全不接受代理票证（并避免 验证代理链的责任），但经验表明，很容易对此感到困惑，并配置为无意中使用/代理验证端点 但未仔细检查 票证验证响应中出现的任何代理链。 因此，代理身份验证需要仔细配置以进行适当的安全控制： ，如果不需要代理身份验证，建议禁用 CAS 服务器中的代理身份验证组件 。

从历史上看，任何服务都可以获得代理授权票证，并从中获得代理票证以访问任何其他服务。 换句话说，安全模型是分散的，而不是集中的。 服务管理设施通过暴露代理身份验证标志来 某种对代理身份验证的集中控制，该标志可以启用或禁用每个服务 。 默认情况下，未授予注册服务代理身份验证功能。

### 证书缓存和重播

_ClearPass_ 扩展提供了一个机制，可以捕获主要身份验证凭据、缓存（加密）、 并根据需要按需重播以访问旧服务。 虽然建议 [代理身份验证](#proxy-authentication) 代替密码重播，但可能需要将旧服务与 CAS 集成。 有关详细信息，请参阅 [清除通行证](../integration/ClearPass.html) 文档。


### 服务管理

服务管理设施提供一些影响安全 策略的服务特定配置控制，并为集中安全策略提供一些支持。 （请注意，CAS 历来支持 分散的安全政策模式。 服务管理控制的一些亮点：

* 授权服务
* 强制认证
* 属性释放
* 代理身份验证控制
* 主题控制
* 服务授权控制
* 多因素服务访问策略

服务管理设施由包含一个或多个注册服务的服务注册处组成，每个 都指定了上述管理控制。 服务注册表可以通过静态配置文件、 Web 用户界面或两者兼有来控制。 有关更多 信息，请参阅 [服务管理](../services/Service-Management.html) 部分。

<div class="alert alert-warning"><strong>授权服务</strong><p>
作为安全最佳实践， <strong>强烈</strong> 建议限制服务管理设施
仅包括授权使用 CAS 的已知应用程序列表。 让管理界面
所有应用程序开放，可能会为安全攻击创造机会。
</p></div>

### SSO曲奇加密

赠票饼干是中科院在建立单一签到会话时设置的 HTTP 饼干。 默认情况下，Cookie 值通过 CAS 属性中定义的设置进行加密和签名。 虽然为初始部署提供了示例数据，但这些密钥 **必须** 根据特定 环境进行再生。 有关详细信息，请 [本指南](../installation/Configuring-SSO.html) 。

### 密码管理安全链接

帐户密码重置请求通过发送到用户注册 电子邮件地址的安全链接处理。 该链接仅在定义的时间窗口 中可用，并且请求由 CAS 正确签署和加密。 虽然为初始部署提供了示例数据，但这些密钥 **必须** 根据您的特定环境进行再生。

有关详细信息，请 [本指南](../installation/Password-Policy-Enforcement.html) 。

### 协议票证加密

由 CAS 签发并与其他应用程序（如服务票证）共享的协议票证可选择地通过签名/加密过程。 即使 CAS 服务器始终会交叉检查机票的有效性和到期政策，但这可能会被迫作为额外的检查，以确保其他应用程序的机票不会被篡改并保持真实性。 虽然为初始部署提供了示例数据，但这些密钥 **必须** 根据您的特定环境进行再生。

<div class="alert alert-warning"><strong>注意</strong><p>加密和签名生成的票证将根据使用的加密方法和算法增加生成的票证长度。 并非所有 CAS 客户都具备处理冗长票串的设备，可能会令您感到不安。 在打开此功能之前评估现有集成，并考虑此功能是否真的需要您的部署。</p></div>

要查看 CAS 属性的相关列表，请 [查看本指南](../configuration/Configuration-Properties.html#protocol-ticket-security)。


### 票证注册表加密

可能需要在聚类 CAS 部署方面进行安全票证复制，以确保 CAS 生成的机票在运输途中不会被篡改。 CAS 通过允许门票进行本地加密和签名来解决此问题。 虽然为初始部署提供了示例数据，但这些密钥 **必须** 根据您的特定环境进行再生。 有关详细信息，请 [本指南](../installation/Ticket-Registry-Replication-Encryption.html) 。

### 行政页面安全

CAS 提供针对系统管理员和部署人员的多种 Web 界面。 这些屏幕以及一些 REST 端点允许 CAS 部署人员管理和重新配置 CAS 行为，而无需使用 本地命令线接口。 不用说，这些端点和屏幕必须得到保护，并且只允许 授权方正常访问。 有关详细信息，请 [本指南](../monitoring/Monitoring-Statistics.html) 。

### 票证到期政策

票证到期政策是实施安全政策的主要机制。 票证到期政策允许 控制 CAS SSO 会话行为的一些重要方面：

* SSO 会话持续时间（滑动到期，绝对）
* 门票重用

有关各种到期政策和配置说明的详细讨论，请参阅 [配置票务组件](../ticketing/Configuring-Ticketing-Components.html) 部分，了解 详细讨论。

### 单个签出

单次注销或单次注销 （SLO） 是一项功能，通过该功能，CAS 服务将收到 CAS SSO 会话终止的通知，期望服务终止 SSO 会话所有者的访问权限。 虽然单次签出可以 改善安全性，但它从根本上说是一个尽最大努力的设施，实际上可能不会终止访问 SSO 会议期间消耗的所有服务 。 以下补偿控制可用于改善与 单一签出缺陷相关的风险：

* 要求对敏感服务进行强制认证
* 减少应用会话超时
* 缩短 SSO 会话持续时间

SLO 可以通过两种方式发生：从 CAS 服务器（后通道注销）和/或从浏览器（前通道注销）。 对于后通道注销，SLO 过程依赖于具有线程池的 `简单HttpClient` 类：必须定义其大小以正确处理所有注销请求。 其他尚未处理的注销请求在发送之前暂时存储在队列中：其大小定义为线程池全球容量的 20%，可以进行调整。 这两种尺寸都是 CAS 系统的关键设置，其值不应超过 CAS 服务器的实际容量。


### 登录限制

CAS 支持政策驱动的功能，以限制连续失败的身份验证尝试，以帮助防止暴力 和拒绝服务攻击。 该功能在后端身份验证商店缺乏等效功能 环境中是有益的。 在基础系统中提供此支持的情况下，我们鼓励将其用于 CAS 功能 ：理由是，基础系统的启用支持提供了包括CAS在内的所有依赖 系统的功能。 有关更多信息，请参阅 [登录限制配置](../installation/Configuring-Authentication-Components.html#login-throttling) 部分。

### 凭据加密

要了解如何通过加密保护 CAS 设置的敏感性，请 [](../configuration/Configuration-Properties-Security.html)查看本指南。

### CAS 安全过滤器

CAS 项目提供了一些钝 [通用安全滤镜，][cas-sec-filter] 适用于修补现场 Java CAS 服务器和 Java CAS 客户端部署，这些部署易受某些基于某些请求参数的坏 CAS 协议输入攻击。 如果该请求不符合 CAS 协议 ，例如，参数重复多次、包括多个值、包含不可接受的值等，则配置过滤器以对身份验证请求参数进行消毒并拒绝请求。

**强烈** 建议对 CAS 的所有部署进行评估，并在必要时包括此配置，以防止在 CAS 容器和环境无法阻止恶意和配置不良的请求的情况下发生 协议攻击。

#### 科尔斯

CAS 为启用 HTTP 访问控制 （CORS） 提供一流的支持。 CORS 的一个应用是，当资源从与第一个资源本身服务的域 请求资源时，会提出跨源 HTTP 请求。 这应该有助于更多支持 CAS 的 通过 XHR/Ajax 请求访问应用程序。

要查看 CAS 属性的相关列表并调整此行为，请 [查看本指南](../configuration/Configuration-Properties.html#http-web-requests)。

#### 安全响应标题

作为 CAS 安全过滤器的一部分，CAS 项目自动提供必要的配置， 将 HTTP 安全头插入 Web 响应中，以防止 HSTS、XSS、X-FRAME 和其他攻击。 默认情况下，这些设置当前处于打开状态。 要查看 CAS 属性的相关列表并调整此行为，请 [查看本指南](../configuration/Configuration-Properties.html#http-web-requests)。

要查看和了解有关这些选项的更多信息，请访问本指南 [][cas-sec-filter]。

### 春季网络流会话

CAS 项目使用春季网络流来管理和协调认证过程。 中科院使用的 网络流的会话状态由客户端管理，然后通过并跟踪认证 过程的各个状态。 必须保护并加密此状态，以防止会话劫持。 虽然 CAS 开箱即用地提供默认加密 设置，但 **强烈** 建议 [所有 CAS 部署](../webflow/Webflow-Customization.html) 在生产部署之前进行 评估，并再生此配置以防止攻击。

### 长期认证

长期身份验证功能通常称为"记住我"，在 CAS 登录 表单上选择（通常通过复选框），以避免长时间重新认证。 长期身份验证允许用户选择额外的便利性， 降低安全性的费用。 安全性降低的程度是用于在 CAS SSO 会话 建立设备的功能。 与标准 CAS SSO 会话相比，从单个用户拥有或操作的设备中建立的长期 SSO 会话的安全性略逊于 。 唯一真正令人担心的是， CAS门票的寿命增加，导致风险敞口增加。 另一方面，通过共享设备建立长期 CAS SSO 会话可能会大大降低安全性。 以前 SSO 会话中的工件影响其他用户建立的后续 SSO 会话的可能性，即使面对单个签出 ，也可能增加仿冒的可能性。 虽然在改进共享设备上长期 SSO 会话的安全 方面没有可行的缓解措施，但教育用户有关固有风险的教育可能会提高整体安全性。

需要注意的是，强制身份验证取代了长期身份验证，因此，如果 将服务配置为强制身份验证，即使在 长期会话的背景下，服务访问也需要身份验证。

在安装过程中，必须通过 [配置和 UI 定制](../installation/Configuring-Authentication-Components.html#long-term-authentication) 明确启用长期身份验证支持。 因此，部署人员选择提供长期身份验证支持，当可用 用户可以选择通过 CAS 登录表上的选择使用它。


### 警告

CAS 支持在已建立的 SSO 会话期间对服务访问进行可选通知。 默认情况下，CAS 透明地请求服务访问所需的门票，并将它们提交目标服务进行验证， 允许在验证成功后访问该服务。 在大多数情况下，这种情况几乎在 立即发生，用户不知道访问支持 CAS 的服务所需的 CAS 认证过程。 了解此过程可能 一些安全益处，CAS 支持一个 _警告用户在 CAS 登录屏幕上 可能选择的_ 标志，以提供访问服务之前显示的插座通知页面。 默认情况下，通知页面为用户提供了一个选项，通过 导航离开目标服务进行 CAS 认证或中止。

[cas-sec-filter]: https://github.com/apereo/cas-server-security-filter

[cas-sec-filter]: https://github.com/apereo/cas-server-security-filter

[cas-sec-filter]: https://github.com/apereo/cas-server-security-filter
