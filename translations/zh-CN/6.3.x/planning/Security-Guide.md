---
layout: 默认
title: CAS-安全指南
category: 规划
---

# 安全指南

CAS是安全软件，可为基于Web的应用程序提供安全的基于Web的单点登录。 单一登录 在安全性和便利性方面双赢：减少了单个信任证书 代理的密码暴露，同时透明地提供了对多种服务的访问，而无需重复登录。 CAS的使用通常为 可以改善安全性环境，但是要实现适当的安全性

<div class="alert alert-info"><strong>报告问题</strong><p>安全团队要求您 <strong>不要</strong> 创建公开可见的问题或帖子，以讨论您认为什么安全漏洞。 要正确报告问题并了解如何生成响应，请 <a href="/cas/developer/Sec-Vuln-Response.html">参见本指南</a>。</p></div>

## 公告内容

- [2020年10月14日漏洞披露](https://apereo.github.io/2020/10/14/gauthvuln/)
- [2020年7月24日漏洞披露](https://apereo.github.io/2020/07/24/credvuln/)
- [2020年2月8日漏洞披露](https://apereo.github.io/2020/02/08/webflowcrypto/)
- [2019年12月20日漏洞披露](https://apereo.github.io/2019/12/20/surrogatevuln/)
- [2019年11月21日漏洞披露](https://apereo.github.io/2019/11/24/smfavuln/)
- [2019年9月27日漏洞披露](https://apereo.github.io/2019/09/27/numvulndisc/)
- [2018年9月26日漏洞披露](https://apereo.github.io/2018/09/26/mfavulndisc/)
- [2017年3月6日漏洞披露](https://apereo.github.io/2017/03/06/moncfgsecvulndisc/)
- [2016年10月24日漏洞披露](https://apereo.github.io/2016/10/24/servlvulndisc/)
- [2016年4月8日漏洞披露](https://apereo.github.io/2016/04/08/commonsvulndisc/)

## 系统安全注意事项

要考虑的基础结构安全性问题可能包括以下内容。

### 安全传输（https）

与CAS服务器的所有通信都必须通过安全通道进行（即 TLSv1）。 此要求有两个主要的

1. 身份验证过程需要传输安全凭证。
2. 授予CAS票证的票证是不记名令牌。

由于任何一种数据的泄露都会允许模拟攻击，因此保护CAS客户端和CAS服务器之间

实际上，这意味着所有CAS URL必须使用HTTPS，但是 **也是** 意味着必须使用HTTPS完成从CAS服务器到应用程序的所有连接

- 当生成的服务票证被发送回“服务” URL上的应用程序时
- 调用代理回调URL时。

要查看CAS属性的相关列表并调整此行为，请 [查阅本指南](../configuration/Configuration-Properties.html#http-client)。


### 与相关系统的连接

CAS通常需要连接到其他系统，例如LDAP目录，数据库和缓存服务。 我们通常建议在可能的情况下使用到这些系统的安全传输（SSL / TLS，IPSec），但可能有 补偿控件，这些安全控制使不必要的安全传输成为可能。 访问控制的专用网络和公司网络是常见的例外，但是仍然建议安全传输。 客户端认证验证可能是LDAP带来足够安全性的另一个很好的解决方案。

如前所述，必须确保与其他系统的连接。 但是，如果将CAS服务器部署在多个节点上，则 表示CAS服务器本身。 如果基于缓存的票证注册表在单个 CAS服务器上运行时没有任何安全问题，则在网络不受保护的情况下使用多个节点时，同步可能会成为安全问题。

如果没有适当地保护，任何磁盘存储也很容易受到攻击。 可以关闭EhCache到磁盘的溢出以增加 保护，而数据库磁盘存储应使用高级加密数据机制。

## 部署驱动的安全功能

CAS支持许多可用于实施各种安全策略的功能。 通过CAS配置和CAS客户端集成提供以下功能。 请注意，许多功能 都是开箱即用的，而其他功能则需要显式设置

### 强制认证

许多CAS客户端和受支持的协议都支持强制身份验证的概念，即用户必须 重新进行身份验证才能访问特定服务。 _renew_ 参数支持强制身份验证。 提供了额外的保证，因为用户必须在访问之前验证其凭据。 强制认证适用于需要或要求更高安全性的服务。 通常，基于每个服务配置 [服务管理](#service-management) 设施 根据集中式安全策略为实现强制身份验证提供了一些支持。 强制身份验证可以与 [多因素身份验证](../configuration/Configuration-Properties.html#multifactor-authentication) 功能 任意特定于服务的访问控制策略。


### 被动认证

某些CAS协议支持被动身份验证，在被动身份验证中，当被请求时， CASv2和CASv3协议通过 _网关_ 功能支持此功能。 被动认证 是强制认证的补充；在强制身份验证需要身份验证才能访问服务的情况下，被动 身份验证允许服务访问（尽管是匿名的），而无需身份验证。


### 代理验证

代理身份验证或委托身份验证提供了功能强大，重要且可能会提高安全性的CAS 代理身份验证受CASv2和CASv3协议支持，并由服务代表用户请求的 因此，该服务代理了用户的身份验证。 代理身份验证通常用于服务无法直接与用户交互的情况，并且是将最终用户凭据重播到服务

但是，代理票证存在风险，因为接受代理票证的服务负责验证 代理链（服务列表，通过该服务列表，委派了最终用户的身份验证以得到 票证验证服务）。 验证端点验证票证来选择完全不接受代理票证（并避免 责任来验证代理链），但是经验表明，对此很容易感到困惑，并且无意中将其 票证验证响应中出现的任何代理链。 因此，代理身份验证需要仔细配置以进行适当的安全控制。 建议禁用代理验证部件在CAS服务器如果代理认证不是 需要。

从历史上看，任何服务都可以获取授予代理的票证，并从中获得访问任何其他服务的代理票证。 换句话说，安全模型是分散的而不是集中的。 服务管理设施通过公开可以在每个服务基础上 提供了一些集中的代理身份验证控制。 默认情况下，注册的服务不被授予代理身份验证功能。

### 凭证缓存和重播

_ClearPass_ 扩展提供了一种机制，用于捕获主要身份验证凭据，将其缓存（加密）， 并根据需要按需重播以访问旧版服务。 虽然 [代理身份验证](#proxy-authentication) 代替密码重播，但是可能需要将旧版服务与CAS集成在一起。 有关详细信息，请参见 [ClearPass](../integration/ClearPass.html)


### 服务管理

服务管理工具提供了许多特定于服务的配置控件，这些控件会影响安全性 策略并为集中式安全性策略提供一些支持。 （请注意，CAS过去一直支持 分散式安全策略模型。） 服务管理控件的一些重点：

* 授权服务
* 强制认证
* 属性发布
* 代理验证控制
* 主题控制
* 服务授权控制
* 多因素服务访问策略

服务管理工具由一个服务注册表组成，该服务注册表包含一个或多个已注册的服务，每个服务中的 指定上面的管理控件。 可以通过静态配置文件， 或Web用户界面或两者来控制服务注册表。 有关更多 信息，请参见 [服务管理](../services/Service-Management.html)

<div class="alert alert-warning"><strong>授权服务</strong><p>
作为安全性最佳实践，强烈</strong> <strong>以限制服务管理工具
仅包括被授权使用CAS的已知应用程序的列表。 将所有应用程序的管理界面
打开状态可能会造成安全攻击的机会。
</p></div>

### SSO Cookie加密

授予票证的cookie是CAS在建立单点登录会话时设置的HTTP cookie。 默认情况下，cookie值是通过CAS属性中定义的设置进行加密和签名的。 而提供了一种用于初始部署的样本数据，这些键 **MUST** 每特定再生 环境。 请 [参阅本指南](../installation/Configuring-SSO.html) 了解更多信息。

### 密码管理安全链接

帐户密码重置请求通过安全链接处理，该链接发送到用户的注册 电子邮件地址。 该链接仅在定义的时间窗口 内可用，并且该请求已由CAS正确签名和加密。 而提供了一种用于初始部署的样本数据，这些键 **MUST** 每特定环境中再生。

请 [参阅本指南](../installation/Password-Policy-Enforcement.html) 了解更多信息。

### 协议票据加密

由CAS发行并与其他应用程序共享的协议票据（例如服务票据）可以选择进行签名/加密过程。 即使CAS服务器将始终交叉检查票证的有效性和过期策略，也可能会强制执行此检查，以确保传输到其他应用程序的票证不会被篡改并保持真实性。 而提供了一种用于初始部署的样本数据，这些键 **MUST** 每特定环境中再生。

<div class="alert alert-warning"><strong>请注意</strong><p>根据所使用的加密方法和算法，对生成的票证进行加密和签名将增加生成的票证的长度。 并非所有的CAS客户都具备处理冗长的机票字符串的能力，并且可能会让您不高兴。 在启用此功能之前，请先评估现有的集成，并考虑您的部署是否真正需要此功能。</p></div>

要查看CAS属性的相关列表，请 [查看本指南](../configuration/Configuration-Properties.html#protocol-ticket-security)。


### 票务注册表加密

对于集群式CAS部署，可能需要安全的票证复制，以确保CAS生成的票证在运输过程中不被篡改。 CAS通过允许对票证进行本机加密和签名来解决此问题。 而提供了一种用于初始部署的样本数据，这些键 **MUST** 每特定环境中再生。 请 [参阅本指南](../installation/Ticket-Registry-Replication-Encryption.html) 了解更多信息。

### 管理页面安全

CAS提供了许多针对系统管理员和部署人员的Web界面。 这些屏幕以及许多REST端点使CAS部署者可以管理和重新配置CAS行为，而无需使用 本机命令行界面。 不用说，这些端点和屏幕必须受到保护，并且仅允许 授权方正确访问。 请 [参阅本指南](../monitoring/Monitoring-Statistics.html) 了解更多信息。

### 票证过期政策

票证过期策略是实施安全策略的主要机制。 票证过期策略允许对CAS SSO会话行为的一些重要方面

* SSO会话时长（滑动到期时间，绝对值）
* 票务重用

有关各种到期策略和配置说明的 详细讨论，请参见“ [配置票证组件](../ticketing/Configuring-Ticketing-Components.html)

### 单一登出

单一注销或单一注销（SLO）是一项功能，通过该功能可通知CAS服务CAS SSO会话的终止，并期望服务终止对SSO会话所有者的访问。 尽管单点注销可以 提高安全性，但从根本上来说，这是一种尽力而为的功能，并且实际上可能不会终止对SSO会话期间消耗的 以下补偿性控制措施可用于改善与 次单次登出缺陷相关的风险：

* 需要对敏感服务进行强制身份验证
* 减少应用程序会话超时
* 减少SSO会话持续时间

SLO可以通过两种方式发生：从CAS服务器（后通道注销）和/或从浏览器（前通道注销）。 对于反向通道注销，SLO进程依赖于 `SimpleHttpClient` 类：必须定义其大小才能正确处理所有注销请求。 其他尚未处理的注销请求在发送之前被临时存储在队列中：其大小定义为线程池全局容量的20％，并且可以调整。 两种大小都是CAS系统的关键设置，它们的值决不能超过CAS服务器的实际容量。


### 登录限制

CAS支持策略驱动的功能，以限制连续失败的身份验证尝试，以帮助防止暴力破解 和拒绝服务攻击。 该功能在后端身份验证存储缺少 等效功能的环境中很有用。 如果在基础系统中可以使用此支持，我们建议您使用它代替CAS功能中的 理由是在底层系统中启用支持可在包括CAS在内的 有关更多信息，请参见 [登录限制配置](../installation/Configuring-Authentication-Components.html#login-throttling)

### 凭证加密

要了解如何CAS敏感的设置都可以通过加密加以保护， [请参阅本指南](../configuration/Configuration-Properties-Security.html)。

### CAS安全过滤器

CAS项目提供了多个钝器 [通用安全筛选器][cas-sec-filter] ，这些筛选器1适合就地修补Java CAS服务器和Java CAS客户端部署，这些部署容易受到基于某些请求参数的不良CAS协议输入攻击的攻击。 过滤器配置为清除身份验证请求参数，如果请求不符合 ，则该请求将被拒绝，例如，如果参数重复多次，包含多个值，包含不可接受的值等。

它是 **强烈** 建议所有CAS部署进行评估，并包括该配置，如果需要防止 在将CAS容器和环境都无法阻止恶意和严重配置的请求的情况下协议的攻击。

#### CORS

CAS为启用HTTP访问控制（CORS）提供了一流的支持。 CORS的一种应用是，当资源从与第一个资源本身所服务的域不同 个域中请求资源时，该资源发出跨域HTTP请求。 通过XHR / Ajax请求访问 应用程序，这应该会帮助更多。

要查看CAS属性的相关列表并调整此行为，请 [查阅本指南](../configuration/Configuration-Properties.html#http-web-requests)。

#### 安全响应标头

作为CAS安全筛选器的一部分，CAS项目自动提供必要的配置，以将 HTTP安全标头插入Web响应，以防止受到HSTS，XSS，X-FRAME和其他攻击。 这些设置当前默认为启用。 要查看CAS属性的相关列表并调整此行为，请 [查阅本指南](../configuration/Configuration-Properties.html#http-web-requests)。

要查看并了解有关这些选项的更多信息，请访问 [本指南][cas-sec-filter]。

### Spring Webflow会话

CAS项目使用Spring Webflow来管理和协调认证过程。 webflow的会话状态由客户端管理，然后在身份验证 流程的各个状态中进行传递和跟踪。 必须保护和加密此状态，以防止会话劫持。 虽然CAS提供了开箱即用的 设置，但强烈建议 **** [所有CAS部署](../webflow/Webflow-Customization.html) 进行 评估，并重新生成此配置以防止受到攻击。

### 长期认证

表单中选择了通常称为“记住我”的长期身份验证功能（通常通过复选框），以避免长时间重新进行身份验证。 长期身份验证允许用户在 选择额外的便利性，但会降低安全性。 安全性降低的程度取决于用于建立 CAS SSO会话的设备的特性。 由单个用户拥有或操作的设备建立的长期SSO会话的安全性比标准CAS SSO会话的 唯一真正关心的问题是使用寿命的延长，以及导致 CAS授予票证的票务暴露的增加。 另一方面，从共享设备建立长期CAS SSO会话可能会大大降低安全性。 来自先前SSO会话的伪像影响由其他用户建立的后续SSO会话的可能性，即使在 ，也可能会增加假冒的可能性。 虽然没有可行的缓解措施来提高 ，但教育用户固有的风险可能会提高整体安全性。

重要的是要注意，强制身份验证取代了长期身份验证，因此，如果 个长期会话的情况下，也需要对服务访问进行身份验证。

在安装过程中， [配置和UI自定义](../installation/Configuring-Authentication-Components.html#long-term-authentication) 显式启用长期身份验证支持。 因此，部署者选择提供长期身份验证支持，并且在可用时 用户可以通过在CAS登录表单上进行选择来选择使用它。


### 警告

在已建立的SSO会话期间，CAS支持服务访问的可选通知。 默认情况下，CAS 透明地请求服务访问所需的票证，并将票证提供给目标服务以进行验证， 从而在成功验证后允许访问该服务。 在大多数情况下，这几乎立即发生为 ，并且用户不知道访问启用了CAS的服务所需的CAS身份验证过程。 可能有 安全好处可以使您对该过程有所了解，并且CAS支持 _警告_ 标志，用户 在CAS登录屏幕上选择1警告2标志，以提供在访问服务之前显示的插页式通知页面。 默认情况下，通知页面为用户提供了进行CAS身份验证或通过 导航离开目标服务而中止的选项。

[cas-sec-filter]: https://github.com/apereo/cas-server-security-filter

[cas-sec-filter]: https://github.com/apereo/cas-server-security-filter
